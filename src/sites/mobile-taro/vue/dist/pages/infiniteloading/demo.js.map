{"version":3,"file":"pages/infiniteloading/demo.js","sources":["webpack:///./src/pages/infiniteloading/demo.vue?3b85","webpack:///./src/pages/infiniteloading/demo.vue","webpack:///./src/pages/infiniteloading/index.taro.vue","webpack:///./src/pages/infiniteloading/index.taro.vue?02f7","webpack:///./src/pages/infiniteloading/demo.vue?fa27","webpack:///./src/pages/infiniteloading/demo.vue?305c","webpack:///./src/pages/infiniteloading/demo.vue?ce30","webpack:///./src/pages/infiniteloading/demo.vue?210c","webpack:///./src/pages/infiniteloading/demo.vue?4342","webpack:///./src/pages/infiniteloading/index.taro.vue?d469","webpack:///./src/pages/infiniteloading/index.taro.vue?4389","webpack:///./src/pages/infiniteloading/index.taro.vue?f7b0","webpack:///./src/pages/infiniteloading/index.taro.vue?1166"],"sourcesContent":["import { render } from \"./demo.vue?vue&type=template&id=355c0724\"\nimport script from \"./demo.vue?vue&type=script&lang=ts\"\nexport * from \"./demo.vue?vue&type=script&lang=ts\"\n\nimport \"./demo.vue?vue&type=style&index=0&id=355c0724&lang=css\"\nscript.render = render\n/* hot reload */\nif (module.hot) {\n  script.__hmrId = \"355c0724\"\n  const api = __VUE_HMR_RUNTIME__\n  module.hot.accept()\n  if (!api.createRecord('355c0724', script)) {\n    api.reload('355c0724', script)\n  }\n  \n  module.hot.accept(\"./demo.vue?vue&type=template&id=355c0724\", () => {\n    api.rerender('355c0724', render)\n  })\n\n}\n\nscript.__file = \"src/pages/infiniteloading/demo.vue\"\n\nexport default script","<template>\n  <view class=\"demo\">\n    <!-- <h2>基础用法</h2>\n    <nut-cell>\n      <view-block class=\"infiniteUl\" id=\"scrollDemo\">\n        <nut-infiniteloading\n          container-id=\"scrollDemo\"\n          :has-more=\"hasMore\"\n          @load-more=\"loadMore\"\n        >\n          <view-block\n            class=\"infiniteLi\"\n            v-for=\"(item, index) in defultList\"\n            :key=\"index\"\n            >{{ item }}</view-block\n          >\n        </nut-infiniteloading>\n      </view-block>\n    </nut-cell> -->\n\n    <h2>下拉刷新</h2>\n    <nut-cell>\n      <view-block class=\"infiniteUl\" id=\"refreshScroll\">\n        <nut-infiniteloading\n          pull-icon=\"JD\"\n          container-id=\"refreshScroll\"\n          :use-window=\"false\"\n          :is-open-refresh=\"true\"\n          :has-more=\"refreshHasMore\"\n          @load-more=\"refreshLoadMore\"\n          @refresh=\"refresh\"\n        >\n          <view-block\n            class=\"infiniteLi\"\n            v-for=\"(item, index) in refreshList\"\n            :key=\"index\"\n            >{{ item }}</view-block\n          >\n        </nut-infiniteloading>\n      </view-block>\n    </nut-cell>\n\n    <!-- <h2>自定义加载文案</h2>\n    <nut-cell>\n      <view-block class=\"infiniteUl\" id=\"customScroll\">\n        <nut-infiniteloading\n          load-txt=\"loading\"\n          load-more-txt=\"没有啦～\"\n          container-id=\"customScroll\"\n          :use-window=\"false\"\n          :has-more=\"customHasMore\"\n          @load-more=\"customLoadMore\"\n        >\n          <view-block\n            class=\"infiniteLi\"\n            v-for=\"(item, index) in customList\"\n            :key=\"index\"\n            >{{ item }}</view-block\n          >\n        </nut-infiniteloading>\n      </view-block>\n    </nut-cell> -->\n  </view>\n</template>\n\n<script lang=\"ts\">\nimport { onMounted, ref, reactive, toRefs } from 'vue';\nimport { createComponent } from './../../../../../../packages/utils/create';\nconst { createDemo } = createComponent('infiniteloading');\nimport Infiniteloading from './index.taro.vue';\nimport Cell from './../cell/index.taro.vue';\n\n// import Toast from './../toast/index.taro.vue';\nexport default createDemo({\n  props: {},\n  components: {\n    'nut-infiniteloading': Infiniteloading,\n    'nut-cell': Cell\n  },\n  setup() {\n    const hasMore = ref(true);\n    const customHasMore = ref(true);\n    const refreshHasMore = ref(true);\n\n    const data = reactive({\n      defultList: [''],\n      customList: [''],\n      refreshList: ['']\n    });\n\n    const loadMore = done => {\n      setTimeout(() => {\n        const curLen = data.defultList.length;\n\n        for (let i = curLen; i < curLen + 10; i++) {\n          data.defultList.push(`${i}`);\n        }\n\n        if (data.defultList.length > 30) hasMore.value = false;\n\n        done();\n      }, 500);\n    };\n\n    const customLoadMore = done => {\n      console.log('记载更多');\n      setTimeout(() => {\n        const curLen = data.customList.length;\n        for (let i = curLen; i < curLen + 10; i++) {\n          data.customList.push(`${i}`);\n        }\n        if (data.customList.length > 30) customHasMore.value = false;\n        done();\n      }, 500);\n    };\n\n    const refreshLoadMore = done => {\n      setTimeout(() => {\n        const curLen = data.refreshList.length;\n        for (let i = curLen; i < curLen + 10; i++) {\n          data.refreshList.push(`${i}`);\n        }\n        if (data.refreshList.length > 30) refreshHasMore.value = false;\n        done();\n      }, 500);\n    };\n\n    const refresh = done => {\n      setTimeout(() => {\n        // Toast.success('刷新成功');\n        done();\n      }, 1000);\n    };\n\n    const init = () => {\n      for (let i = 0; i < 10; i++) {\n        data.defultList.push(`${i}`);\n        data.customList.push(`${i}`);\n        data.refreshList.push(`${i}`);\n      }\n    };\n    onMounted(() => {\n      init();\n    });\n\n    return {\n      loadMore,\n      hasMore,\n      customHasMore,\n      customLoadMore,\n      refreshHasMore,\n      refreshLoadMore,\n      refresh,\n      ...toRefs(data)\n    };\n  }\n});\n</script>\n\n<style>\n.infiniteUl {\n  height: 300px;\n  width: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n.infiniteLi {\n  margin-top: 10px;\n  font-size: 14px;\n  color: rgba(100, 100, 100, 1);\n  text-align: center;\n}\n\n.loading {\n  display: block;\n  width: 100%;\n  text-align: center;\n}\n</style>\n","<template>\n  <scroll-view\n    :class=\"classes\"\n    scrollY=\"true\"\n    style=\"height: 100%\"\n    id=\"scroller\"\n    @scrolltolower=\"lower\"\n    @scroll=\"scroll\"\n    @touchstart=\"touchStart\"\n    @touchmove=\"touchMove\"\n    @touchend=\"touchEnd\"\n  >\n    <view-block class=\"nut-infinite-top\" :style=\"getStyle\">\n      <view-block class=\"top-box\" id=\"refreshTop\">\n        <nut-icon class=\"top-img\" :name=\"pullIcon\"></nut-icon>\n        <view-block class=\"top-text\">{{ pullTxt }}</view-block>\n      </view-block>\n    </view-block>\n\n    <view-block class=\"nut-infinite-container\">\n      <slot></slot>\n    </view-block>\n\n    <view-block class=\"nut-infinite-bottom\">\n      <template v-if=\"isInfiniting\">\n        <view-block class=\"bottom-box\">\n          <nut-icon class=\"bottom-img\" :name=\"loadIcon\"></nut-icon>\n          <view-block class=\"bottom-text\">{{ loadTxt }}</view-block>\n        </view-block>\n      </template>\n      <template v-else-if=\"!hasMore\">\n        <view-block class=\"tips\">{{ loadMoreTxt }}</view-block>\n      </template>\n    </view-block>\n  </scroll-view>\n</template>\n<script lang=\"ts\">\nimport { toRefs, onMounted, reactive, computed, CSSProperties } from 'vue';\nimport { createComponent } from './../../../../../../packages/utils/create';\nconst { componentName, create } = createComponent('infiniteloading');\nimport Icon from './../icon/index.taro.vue';\nimport Taro from '@tarojs/taro';\nexport default create({\n  props: {\n    hasMore: {\n      type: Boolean,\n      default: true\n    },\n    threshold: {\n      type: Number,\n      default: 200\n    },\n    pullIcon: {\n      type: String,\n      default:\n        'https://img10.360buyimg.com/imagetools/jfs/t1/169863/6/4565/6306/60125948E7e92774e/40b3a0cf42852bcb.png'\n    },\n    pullTxt: {\n      type: String,\n      default: '松开刷新'\n    },\n    loadIcon: {\n      type: String,\n      default:\n        'https://img10.360buyimg.com/imagetools/jfs/t1/169863/6/4565/6306/60125948E7e92774e/40b3a0cf42852bcb.png'\n    },\n    loadTxt: {\n      type: String,\n      default: '加载中···'\n    },\n    loadMoreTxt: {\n      type: String,\n      default: '哎呀，这里是底部了啦'\n    },\n    useWindow: {\n      type: Boolean,\n      default: true\n    },\n    containerId: {\n      type: String,\n      default: ''\n    },\n    useCapture: {\n      type: Boolean,\n      default: false\n    },\n    isOpenRefresh: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['scroll-change', 'load-more', 'refresh'],\n  components: {\n    'nut-icon': Icon\n  },\n  setup(props, { emit, slots }) {\n    const state = reactive({\n      scrollHeight: 0,\n      scrollTop: 0,\n      isInfiniting: false,\n      direction: 'down',\n      isTouching: false,\n      refreshMaxH: 0,\n      y: 0,\n      x: 0,\n      distance: 0\n    });\n\n    const classes = computed(() => {\n      const prefixCls = componentName;\n      return {\n        [prefixCls]: true\n      };\n    });\n\n    const getStyle = computed(() => {\n      const style: CSSProperties = {};\n      return {\n        height: state.distance < 0 ? `0px` : `${state.distance}px`,\n        transition: state.isTouching\n          ? `height 0s cubic-bezier(0.25,0.1,0.25,1)`\n          : `height 0.2s cubic-bezier(0.25,0.1,0.25,1)`\n      };\n    });\n    const getParentElement = el => {\n      return Taro.createSelectorQuery().select(\n        !!props.containerId ? `#${props.containerId} #${el}` : `#${el}`\n      );\n    };\n    /** 获取需要滚动的距离 */\n    const getScrollHeight = () => {\n      const parentElement = getParentElement('scroller');\n      // state.scrollEl = props.useWindow ? window : parentElement;\n\n      parentElement\n        .boundingClientRect(rect => {\n          state.scrollHeight = rect.height;\n          console.log(rect.height);\n        })\n        .exec();\n    };\n\n    /** 滚动到底部 */\n    const lower = () => {\n      console.log('加载到底部', props.containerId);\n      if (state.direction == 'up' || !props.hasMore || state.isInfiniting) {\n        return false;\n      } else {\n        console.log('加载到底部1111');\n        state.isInfiniting = true;\n        emit('load-more', infiniteDone);\n      }\n    };\n\n    const scroll = e => {\n      // 滚动方向\n      if (e.detail.scrollTop <= 0) {\n        // 滚动到最顶部\n        e.detail.scrollTop = 0;\n      } else if (e.detail.scrollTop >= state.scrollHeight) {\n        // 滚动到最底部\n        e.detail.scrollTop = state.scrollHeight;\n      }\n      if (\n        e.detail.scrollTop > state.scrollTop ||\n        e.detail.scrollTop >= state.scrollHeight\n      ) {\n        state.direction = 'down';\n      } else {\n        state.direction = 'up';\n      }\n      state.scrollTop = e.detail.scrollTop;\n      console.log(state.scrollTop);\n\n      emit('scroll-change', e.detail.scrollTop);\n    };\n\n    const infiniteDone = () => {\n      state.isInfiniting = false;\n    };\n\n    const touchStart = (event: TouchEvent) => {\n      if (state.scrollTop == 0 && !state.isTouching && props.isOpenRefresh) {\n        state.y = event.touches[0].pageY;\n        state.isTouching = true;\n        getParentElement('refreshTop')\n          .boundingClientRect(rect => {\n            console.log(rect);\n            state.refreshMaxH = Math.floor(rect.height * 1 + 10);\n          })\n          .exec();\n      }\n    };\n\n    const touchMove = (event: TouchEvent) => {\n      state.distance = event.touches[0].pageY - state.y;\n\n      if (state.distance > 0 && state.isTouching) {\n        event.preventDefault();\n        if (state.distance >= state.refreshMaxH)\n          state.distance = state.refreshMaxH;\n      } else {\n        state.distance = 0;\n        state.isTouching = false;\n      }\n    };\n\n    const touchEnd = () => {\n      if (state.distance < state.refreshMaxH) {\n        state.distance = 0;\n      } else {\n        emit('refresh', refreshDone);\n      }\n    };\n\n    const refreshDone = () => {\n      state.distance = 0;\n      state.isTouching = false;\n    };\n\n    onMounted(() => {\n      setTimeout(() => {\n        getScrollHeight();\n      }, 200);\n    });\n\n    return {\n      classes,\n      ...toRefs(state),\n      lower,\n      scroll,\n      touchStart,\n      touchMove,\n      touchEnd,\n      getStyle\n    };\n  }\n});\n</script>\n\n<style lang=\"scss\">\n@import '../../../../../../packages/__VUE/infiniteloading/index.scss';\n</style>\n","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/taro-loader/lib/raw.js!./demo.vue\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/infiniteloading/demo', {root:{cn:[]}}, config || {}))\n\n","export { default } from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./demo.vue?vue&type=script&lang=ts\"; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./demo.vue?vue&type=script&lang=ts\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js??ref--4-oneOf-0-1!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??postcss!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./demo.vue?vue&type=style&index=0&id=355c0724&lang=css\"","export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/templateLoader.js??ref--6!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./demo.vue?vue&type=template&id=355c0724\"","import { render } from \"./index.taro.vue?vue&type=template&id=6ed18bd1\"\nimport script from \"./index.taro.vue?vue&type=script&lang=ts\"\nexport * from \"./index.taro.vue?vue&type=script&lang=ts\"\n\nimport \"./index.taro.vue?vue&type=style&index=0&id=6ed18bd1&lang=scss\"\nscript.render = render\n/* hot reload */\nif (module.hot) {\n  script.__hmrId = \"6ed18bd1\"\n  const api = __VUE_HMR_RUNTIME__\n  module.hot.accept()\n  if (!api.createRecord('6ed18bd1', script)) {\n    api.reload('6ed18bd1', script)\n  }\n  \n  module.hot.accept(\"./index.taro.vue?vue&type=template&id=6ed18bd1\", () => {\n    api.rerender('6ed18bd1', render)\n  })\n\n}\n\nscript.__file = \"src/pages/infiniteloading/index.taro.vue\"\n\nexport default script","export { default } from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.taro.vue?vue&type=script&lang=ts\"; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.taro.vue?vue&type=script&lang=ts\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js??ref--1-oneOf-0-1!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??postcss!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js??ref--1-oneOf-0-4!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.taro.vue?vue&type=style&index=0&id=6ed18bd1&lang=scss\"","export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/templateLoader.js??ref--6!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.taro.vue?vue&type=template&id=6ed18bd1\""],"mappings":";;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAYA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AC2CA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAlFA;;;;;;;;;;;;;;;;;;;;;;;ACpCA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AA3CA;AAgDA;AACA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAYA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAMA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AAlMA;;;;;;;;;;;;;;;;;;ADzCA;;;AAmBA;AAAA;AAAA;AACA;;;;;;;;AApBA;AAqBA;AAAA;AAAA;AAAA;AAiBA;AAhBA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AAJA;AAAA;AAFA;AACA;AAEA;AAEA;AADA;AAAA;AAAA;AAAA;AAAA;;;;AAJA;;AAAA;AAKA;;AALA;AAEA;;;;AAXA;;AAAA;AAAA;;;;AADA;AAAA;;;;AAkBA;;;;;;;;;;;;;;;;;;;;;;;ACvCA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAwBA;AAtBA;AAAA;AAKA;AAJA;AAAA;AAAA;AAAA;AAGA;AAFA;AAAA;AAAA;AAAA;AAAA;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAAA;AADA;;;;AADA;AAAA;;;;AADA;;AAAA;AAOA;AAEA;AADA;AAAA;AAAA;;;;AADA;AAIA;AAUA;AATA;AAAA;AAIA;AAHA;AAGA;AAFA;AAAA;AAAA;AAAA;AAAA;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAAA;AADA;;;;AADA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAAA;AAPA;;;;AADA;;AAtBA;;;;;;;;;;;;ACDA;;;;;;;;;;;ACAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;;;;;;;;;;;;;;ACAA;AAAA;AAAA;;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAYA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;;;;;;;;;;;;;;ACAA;AAAA;AAAA;;;;;A","sourceRoot":""}